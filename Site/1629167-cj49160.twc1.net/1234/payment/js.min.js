!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=32)}([function(e,t){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(16),s=n(17),c=n(18),l={settings:{coreHost:"https://core.spreedly.com"}};function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;return"".concat(t.settings.coreHost,"/api/internal/v1/transactions/").concat(e,"/status.json")}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return e.environmentKey&&(t["Spreedly-Environment-Key"]=e.environmentKey),t}var p=function(){function e(t,n,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:500,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l;(0,i.default)(this,e),this.endpoint=u(t,d),this.done=n,this.handleData=this.handleData.bind(this),this.handleError=this.handleError.bind(this),this.fetchData=this.fetchData.bind(this),this.retryable=new s(a,c,this.fetchData,r),this.environmentKey=o}return(0,o.default)(e,[{key:"run",value:function(){this.retryable.runNow()}},{key:"stop",value:function(){this.retryable.stop()}},{key:"fetchData",value:function(){var e=d({environmentKey:this.environmentKey}),t=(new Date).getTime();a.getJSON("".concat(this.endpoint,"?time=").concat(t),this.handleData,this.handleError,e)}},{key:"handleData",value:function(e){return!!this.retryable.isRunning()&&(e.transaction&&e.transaction.state&&"pending"!==e.transaction.state?(this.retryable.stop(),this.done(e.transaction),!0):(this.done(e.transaction),this.retryable.runLater(),!0))}},{key:"handleError",value:function(){return!!this.retryable.isRunning()&&(this.retryable.runLater(),!0)}}],[{key:"withStatus",value:function(e,t,n,r){var i=d({environmentKey:t});a.getJSON(u(e),n,r,i)}},{key:"withContext",value:function(t,n,r,i){e.withStatus(t,n,(function(e){r(c.decode(e.transaction&&e.transaction.context)||e.transaction)}),i)}},{key:"contextFrom",value:function(e){var t=null;if(e.transaction&&e.transaction.context)try{var n=window.atob(e.transaction.context);t=window.JSON.parse(n)}catch(e){}return t}}]),e}();e.exports=p},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";e.exports={ajax:{post:function(e,t,n){var r=new XMLHttpRequest,i=JSON.parse(t);r.onreadystatechange=function(){4===r.readyState&&n(r.status,r.responseText)},r.open("POST",e,!0),r.setRequestHeader("CONTENT-TYPE","application/json"),i&&i.environment_key&&r.setRequestHeader("Spreedly-Environment-Key",i.environment_key),r.send(t)}},addListener:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},addInputListener:function(e,t){void 0===e.oninput||null===e.oninput?(this.addListener(e,"change",t),this.addListener(e,"keyup",t)):this.addListener(e,"input",t)},removeListener:function(e,t,n){e&&(e.addEventListener?e.removeEventListener(t,n,!1):e.attachEvent&&"string"==typeof t&&"function"==typeof n&&e.detachEvent("on"+t,n))},getElementWithAttribute:function(e,t){for(var n=document.getElementsByTagName(e),r=0;r<n.length;r++)if(n[r].getAttribute(t))return n[r]},domain:function(e){if(void 0!==e){var t=e.match(/^(https?:\/\/[^\/?#]+)(?:[\/?#]|$)/i);return t&&t[1]}},camelize:function(e){if(void 0!==e){var t=e.split("-");if(1===t.length)return e;for(var n=t[0],r=1;r<t.length;r++){var i=t[r];n=n+i.charAt(0).toUpperCase()+i.slice(1)}return n}},stripTags:function(e){if("string"==typeof e)return e.replace(/(<([^>]+)>)/gi,"")},setText:function(e,t){void 0!==e&&void 0!==t&&(e.textContent&&void 0!==e.textContent?e.textContent=t:e.innerText=t)},style:function(e,t,n){if(void 0!==t&&void 0!==n){var r=this.camelize(t.trim());if(this.cssProperties.indexOf(r)>=0)for(var i=0;i<e.length;i++){e[i].style[this.cssToJsProperty(r)]=n.trim()}}},removeClass:function(e,t){var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)","g");e.className=e.className.replace(n,"")},hasClass:function(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(t,n){e.exports.hasClass(t,n)||(t.className+=" "+n)},cssToJsProperty:function(e){return this.cssToJsPropertyMappings[e]||e},cssProperties:["accentColor","alignContent","alignItems","alignSelf","alignTracks","all","animation","animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimeline","animationTimingFunction","appearance","aspectRatio","backdropFilter","backfaceVisibility","background","backgroundAttachment","backgroundBlendMode","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPosition","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize","blockSize","border","borderBlock","borderBlockColor","borderBlockEnd","borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth","borderBlockStart","borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth","borderBlockStyle","borderBlockWidth","borderBottom","borderBottomColor","borderBottomLeftRadius","borderBottomRightRadius","borderBottomStyle","borderBottomWidth","borderCollapse","borderColor","borderEndEndRadius","borderEndStartRadius","borderImage","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderInline","borderInlineColor","borderInlineEnd","borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth","borderInlineStart","borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth","borderInlineStyle","borderInlineWidth","borderLeft","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRadius","borderRight","borderRightColor","borderRightStyle","borderRightWidth","borderSpacing","borderStartEndRadius","borderStartStartRadius","borderStyle","borderTop","borderTopColor","borderTopLeftRadius","borderTopRightRadius","borderTopStyle","borderTopWidth","borderWidth","bottom","boxDecorationBreak","boxShadow","boxSizing","breakAfter","breakBefore","breakInside","captionSide","caretColor","clear","clip","clipPath","color","columnCount","columnFill","columnGap","columnRule","columnRuleColor","columnRuleStyle","columnRuleWidth","columnSpan","columnWidth","columns","contain","content","contentVisibility","counterIncrement","counterReset","counterSet","cursor","direction","display","emptyCells","filter","flex","flexBasis","flexDirection","flexFlow","flexGrow","flexShrink","flexWrap","float","font","fontFamily","fontFeatureSettings","fontLanguageOverride","fontOpticalSizing","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontSynthesis","fontVariant","fontVariantAlternatives","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontVariationSettings","fontWeight","forcedColorAdjust","gap","grid","gridArea","gridAutoColumns","gridAutoFlow","gridAutoRows","gridColumn","gridColumnEnd","gridColumnStart","gridRow","gridRowEnd","gridRowStart","gridTemplate","gridTemplateAreas","gridTemplateColumns","gridTemplateRows","hangingPunctuation","height","hyphenatedCharacter","hyphens","imageOrientation","imageRendering","imageResolution","inherit","initial","initialLetter","initialLetterAlign","inlineSize","inset","insetBlock","insetBlockEnd","insetBlockStart","insetInline","insetInlineEnd","insetInlineStart","isolation","justifyContent","justifyItems","justifySelf","justifyTracks","left","letterSpacing","lineBreak","lineHeight","lineHeightStep","listStyle","listStyleImage","listStylePosition","listStyleType","margin","marginBlock","marginBlockEnd","marginBlockStart","marginBottom","marginInline","marginInlineEnd","marginInlineStart","marginLeft","marginRight","marginTop","marginTrim","maxBlockSize","maxHeight","maxInlineSize","maxWidth","minBlockSize","minHeight","minInlineSize","minWidth","mixBlendMode","objectFit","objectPosition","offset","offsetAnchor","offsetDistance","offsetPath","offsetPosition","offsetRotate","opacity","order","orphans","outline","outlineColor","outlineOffset","outlineStyle","outlineWidth","overflow","overflowAnchor","overflowBlock","overflowClipMargin","overflowInline","overflowWrap","overflowX","overflowY","overscrollBehavior","overscrollBehaviorBlock","overscrollBehaviorInline","overscrollBehaviorX","overscrollBehaviorY","padding","paddingBlock","paddingBlockStart","paddingBlockEnd","paddingBottom","paddingInline","paddingInlineEnd","paddingInlineStart","paddingLeft","paddingRight","paddingTop","pageBreakAfter","pageBreakBefore","pageBreakInside","perspective","perspectiveOrigin","placeContent","placeItems","placeSelf","pointerEvents","position","printColorAdjust","quotes","resize","revert","right","rotate","scale","tabSize","tableLayout","textAlign","textAlignLast","textAlignUpright","textDecoration","textDecorationColor","textDecorationLine","textDecorationStyle","textDecorationThickness","textEmphasis","textEmphasisColor","textEmphasisPosition","textEmphasisStyle","textIndent","textJustify","textOrientation","textOverflow","textRendering","textShadow","textSizeAdjust","textTransform","textUnderlineOffset","textUnderlinePosition","top","touchAction","transform","transformBox","transformOrigin","transformStyle","transition","transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction","unicodeBidi","verticalAlign","visibility","whiteSpace","widows","width","willChange","wordBreak","wordSpacing","wordWrap","writingMode","zIndex","-moz-appearance","-webkit-appearance"],cssToJsPropertyMappings:{float:"cssFloat"},mobile:screen.width<=480,browserVersion:function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?"IE "+((e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""):"Chrome"===n[1]&&null!=(e=t.match(/\bOPR\/(\d+)/))?"Opera "+e[1]:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}}},function(e,t,n){var r=n(8)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(e,t,n){var r=n(5).default;function i(){"use strict";
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function d(e,t,n,r){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new _(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return I()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h={};function f(){}function m(){}function v(){}var y={};u(y,s,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(O([])));b&&b!==n&&o.call(b,s)&&(y=b);var w=v.prototype=f.prototype=Object.create(y);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){var n;this._invoke=function(i,a){function s(){return new t((function(n,s){!function n(i,a,s,c){var l=p(e[i],e,a);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==r(d)&&o.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):t.resolve(d).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,c)}))}c(l.arg)}(i,a,n,s)}))}return n=n?n.then(s,s):s()}}function E(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return h;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=p(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,h;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function O(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:I}}function I(){return{value:void 0,done:!0}}return m.prototype=v,u(w,"constructor",v),u(v,"constructor",m),m.displayName=u(v,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,l,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},k(x.prototype),u(x.prototype,c,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new x(d(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(w),u(w,l,"Generator"),u(w,s,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=O,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),c=o.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t){function n(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var a=e.apply(t,r);function s(e){n(a,i,o,s,c,"next",e)}function c(e){n(a,i,o,s,c,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,n){"use strict";var r=n(46)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";e.exports=function(){var e=(new Date).getTime();return"xxxxxxxxxxxxxxxxx".replace(/x/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}},function(e,t,n){"use strict";e.exports=function(e){return"string"==typeof e&&!!e.match(/^\s*\S+/)}},function(e,t,n){"use strict";e.exports=function(e,t){return e[t]&&e[t].cdata||e[t]}},,function(e,t,n){"use strict";e.exports=function(e){return null!=e}},function(e,t,n){"use strict";var r={getJSON:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};r.setupRequest(e,"GET",t,n,i).send()},postJSON:function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};r.setupRequest(e,"POST",n,i,o).send(JSON.stringify(t))},setupRequest:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState){var e=null;try{(e=JSON.parse(this.responseText)).status=this.status}catch(t){e={status:this.status,unparseable:!0,message:"Unable to parse the response."}}this.status<400?n(e):r(e)}},o.open(t,e,!0),o.setRequestHeader("Accept","application/json"),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Cache-Control","no-cache");for(var a=0,s=Object.keys(i);a<s.length;a++){var c=s[a];o.setRequestHeader(c,i[c])}return o}};e.exports=r},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(t,n,r,o){(0,i.default)(this,e),this.count=1,this.max=t,this.delay=n,this.work=r,this.exceeded=o,this.timeoutId=null,this.running=!0,this.runNow=this.runNow.bind(this),this.runLater=this.runLater.bind(this),this.isRunning=this.isRunning.bind(this)}return(0,o.default)(e,[{key:"runNow",value:function(){return!!this.running&&(this.work(),this.count++,!(this.count>this.max)||(this.exceeded(),this.stop(),!1))}},{key:"runLater",value:function(){var e=this;return!!this.isRunning()&&(this.timeoutId=setTimeout((function(){return e.runNow()}),this.delay),!0)}},{key:"stop",value:function(){this.running=!1,this.timeoutId&&clearTimeout(this.timeoutId)}},{key:"isRunning",value:function(){return this.running}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"decode",value:function(e){if(e)try{return window.JSON.parse(window.atob(e))}catch(e){}return null}}]),e}();e.exports=a},function(e,t,n){"use strict";e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=null==e,i="".concat(t," is required");if(r&&n)console.warn(i);else if(r)throw i;return e}},function(e,t,n){"use strict";var r=n(0),i=r(n(4)),o=r(n(1)),a=r(n(2));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=n(11),u=n(12),d=n(19),p=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l();(0,o.default)(this,e),this.frameId=t,this.destination=n,this.contents=r,this.token=i}return(0,a.default)(e,[{key:"inject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(document.getElementById(this.frameId))return!1;var t=document.getElementById(this.destination),n=document.createElement("iframe"),r=this.token;return e.show||(n.style.display="none"),e.classes&&(n.className=e.classes),n.src=e.src?e.src:"data:text/html;charset=utf-8,"+this.encodeContentsAndReceiverScript(),n.id=this.frameId,e.submit&&(n.onload=function(){n.contentWindow.postMessage(r,"*")}),t.appendChild(n),!0}},{key:"encodeContentsAndReceiverScript",value:function(){return encodeURI(this.contents+this.generateReceiverScript())}},{key:"generateReceiverScript",value:function(){return"\n    <script>\n      function messageHandler(event) {\n        if (event.data === '".concat(this.token,"' && document.forms && document.forms[0]) {\n          document.forms[0].submit()\n        }\n      }\n\n      if (window.addEventListener) {\n        window.addEventListener('message', messageHandler, false)\n      } else {\n        window.attachEvent('onmessage', messageHandler)\n      }\n    <\/script>\n    ")}}]),e}();e.exports={FrameManager:p,makeFrameManager:function(e){var t=e.frameManagerClass||p,n=e.frameId,r=e.destination,i=e.url,o=e.contents,a=e.injectOptions||{};d(n,"options.frameId"),d(i||o,"options.url or options.contents");var s=null,l=!1;return(u(i)||u(o))&&(s=new t(n,r,o),l=i?s.inject(c({submit:!1,src:i},a)):s.inject(c({submit:!0},a))),{success:l,frameManager:s}}}},,,,,,,,,,,,function(e,t,n){"use strict";var r=n(0),i=r(n(7)),o=r(n(5)),a=r(n(9));function s(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var l=n(6),u=n(33),d=n(34),p=n(53),h=n(58),f=n(59),m=n(3),v=n(73),y=function(e){return document.getElementById("spreedly-iframe")?document.getElementById("spreedly-iframe").getAttribute(e):null},g=function(e,t){return null===t||0===t.length?e:e+(e.indexOf("?")>=0?"&":"?")+t},b=function(e){return"express"===e?"client="+e:""};function w(){var e=this;this.Utils=h,this.ThreeDS=f,this.init=function(e,t){this.isLoaded()&&this.unload(),t&&t.source&&(this.source=t.source),t&&t.numberEl?this.numberTarget=t.numberEl:this.numberTarget=y("data-number-id"),t&&t.cvvEl?this.cvvTarget=t.cvvEl:this.cvvTarget=y("data-cvv-id"),this.environmentKey=e||y("data-environment-key"),this.numberFrameId="spreedly-number-frame-"+this.uniqueId,this.cvvFrameId="spreedly-cvv-frame-"+this.uniqueId,this.addIframeElements()},this.c2pInit=function(){var e=(0,a.default)(i.default.mark((function e(t,n){var r,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.environmentKey=t||y("data-environment-key"),null!=n&&n.c2pConfig){e.next=4;break}return console.error("Click to Pay options are not present!"),e.abrupt("return");case 4:if(!(r=this.c2pSDKValidationAndInitialParams(n.isTest)).isValid){e.next=14;break}this.locale=r.c2pDpaLocale,n.c2pConfig.srcDpaId=r.srcDpaId,n.c2pConfig.dpaTransactionOptions.dpaLocale=this.locale,n.c2pSandbox=r.c2pSandbox,n.c2pSrc=r.c2pSrc,this.click2payInstance=new window.Click2Pay,e.next=16;break;case 14:return console.error("Mastercard SDK is not present!"),e.abrupt("return");case 16:return e.prev=16,e.next=19,this.click2payInstance.init(n.c2pConfig);case 19:o=e.sent,this.c2pInitiated(o,n),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(16),this.c2pError("c2p_invalid_initialization_options","C2P invalid initialization options.");case 26:case"end":return e.stop()}}),e,this,[[16,23]])})));return function(t,n){return e.apply(this,arguments)}}(),this.c2pInitiated=function(){var t=(0,a.default)(i.default.mark((function t(n,r){var o,a;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.availableCardBrands&&n.availableServices.length>=1)){t.next=27;break}return o=["mastercard","visa","discover","amex"],e.availableCardBrands=n.availableCardBrands.sort((function(e,t){return o.indexOf(e)-o.indexOf(t)})),e.cardBrands=e.availableCardBrands.join(","),e.c2p={config:r.c2pConfig,frame_id:r.c2pFrameEl,frame_style:r.c2pFrameStyle,dpaId:r.c2pConfig.srcDpaId,isSandbox:r.c2pSandbox,src:r.c2pSrc},e.c2pSandboxLog("C2P valid options"),t.prev=6,t.next=9,e.click2payInstance.getCards();case 9:a=t.sent,t.next=16;break;case 12:return t.prev=12,t.t0=t.catch(6),e.c2pError("c2p_card_retrieval",t.t0),t.abrupt("return");case 16:if(e.c2pSandboxLog(a),!(a.length>0)){t.next=23;break}return e.c2pSandboxLog("Display cards"),t.next=21,e.displayCards(r,a);case 21:t.next=25;break;case 23:e.c2pSandboxLog("Identity lookup"),e.identifyLookup(r);case 25:t.next=28;break;case 27:console.error("C2P not valid options");case 28:case"end":return t.stop()}}),t,null,[[6,12]])})));return function(e,n){return t.apply(this,arguments)}}(),this.c2pSandboxLog=function(){var t;e.c2p.isSandbox&&(t=console).log.apply(t,arguments)},this.loadIdentifyLookupOptions=function(e){var t,n,r,i,o,a={mobileNumber:{}};null!=e&&null!==(t=e.customer)&&void 0!==t&&t.email&&(a.email=e.customer.email),null!=e&&null!==(n=e.customer)&&void 0!==n&&null!==(r=n.phone)&&void 0!==r&&r.number&&(a.mobileNumber.phoneNumber=e.customer.phone.number),null!=e&&null!==(i=e.customer)&&void 0!==i&&null!==(o=i.phone)&&void 0!==o&&o.countryCode&&(a.mobileNumber.countryCode=e.customer.phone.countryCode);var s=this.getMerchantElementById(null==e?void 0:e.emailEl,"data-email-id"),c=this.getMerchantElementById(null==e?void 0:e.phoneEl,"data-phone-id"),l=this.getMerchantElementById(null==e?void 0:e.countryCodeEl,"data-country-code-id");return null!=s&&s.value&&(a.email=s.value),null!=c&&c.value&&(a.mobileNumber.phoneNumber=c.value),null!=l&&l.value&&(a.mobileNumber.countryCode=l.value),a},this.getIdLookup=function(e){var t,n,r,i;return this.customer=this.loadIdentifyLookupOptions(e),"phoneNumber"===("phonenumber"===(null===(t=e.customer)||void 0===t||null===(n=t.mainLookupMethod)||void 0===n?void 0:n.toLowerCase())?"phoneNumber":"email")?this.isMobileNumberPresent(null===(r=this.customer)||void 0===r?void 0:r.mobileNumber)?{mobileNumber:this.customer.mobileNumber}:{email:this.customer.email}:null!==(i=this.customer)&&void 0!==i&&i.email?{email:this.customer.email}:{mobileNumber:this.customer.mobileNumber}},this.isMobileNumberPresent=function(e){return(null==e?void 0:e.countryCode)&&(null==e?void 0:e.phoneNumber)},this.identifyLookup=function(){var e=(0,a.default)(i.default.mark((function e(t){var n,r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.getIdLookup(t),e.next=4,this.click2payInstance.idLookup(n);case 4:null!=(r=e.sent)&&r.consumerPresent?this.handleOTP(t):this.makeVisibleNormalInit(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),this.c2pError("c2p_lookup",e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),this.c2pCVVContainer=function(){var e=document.getElementById(this.cvvTarget);this.cvvContainerTarget&&(this.cvvContainerEl=document.getElementById(this.cvvContainerTarget),this.cvvContainerEl?this.cvvContainerEl.appendChild(e):this.cardsEl.parentNode.insertBefore(e,this.cardsEl.nextSibling))},this.displayCards=function(){var e=(0,a.default)(i.default.mark((function e(t,n){var r,o,s,c,l=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this,this.cardsEl=this.getMerchantElementById(null==t?void 0:t.cardsEl,"data-cards-id"),o=n[0],s=null==t?void 0:t.displayCards,this.cardsEl.style.visibility="visible",c=["radioButton","gridView"],this.c2pSandboxLog("Display card list"),this.cardsEl.displaySignOut="boolean"!=typeof(null==s?void 0:s.displaySignOut)||s.displaySignOut,this.cardsEl.displayPreferredCard="boolean"!=typeof(null==s?void 0:s.displayPreferredCard)||s.displayPreferredCard,this.cardsEl.cardBrands=this.cardBrands,this.cardsEl.cardSelectionType=c.includes(null==s?void 0:s.cardSelectionType)?s.cardSelectionType:"radioButton",this.cardsEl.loadCards(n),this.cardsEl.displayAddCard="boolean"!=typeof(null==s?void 0:s.displayAddCard)||s.displayAddCard,this.cardsEl.locale=this.locale,this.cardsEl.srcDigitalCardId=o.srcDigitalCardId,this.init(this.environmentKey,t),this.cvvContainerTarget=null!=t&&t.cvvContainerEl?t.cvvContainerEl:y("data-cvv-container-id"),this.c2pCVVContainer(),this.emit("display-cards-ready"),this.c2pSandboxLog("default srcDigitalCardId:",this.cardsEl.srcDigitalCardId),this.cardsEl.addEventListener("selectSrcDigitalCardId",(function(e){r.c2pSandboxLog("srcDigitalCardId: ",e.detail),r.srcDigitalCardId=e.detail})),this.cardsEl.addEventListener("clickAddCardLink",(function(e){r.c2pSandboxLog("Add a Card button clicked: ",e),r.cardsEl.style.visibility="hidden",r.cardsEl.style.display="none",r.makeVisibleNormalInit(t)})),this.cardsEl.addEventListener("clickSignOutLink",(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.click2payInstance.signOut();case 3:return r.cardsEl.style.visibility="hidden",r.emit("c2p-session-deleted"),e.abrupt("return",!1);case 8:e.prev=8,e.t0=e.catch(0),l.c2pError("c2p_sign_out",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))));case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),this.makeVisibleNormalInit=function(e){var t=this;this.init(this.environmentKey,e),this.emit("add-new-card",this.availableCardBrands);var n=this.getMerchantElementById(null==e?void 0:e.spreedlyPaymentFormEl,"data-spreedly-payment-form-id");n.style.visibility="visible";var r=this.getMerchantElementById(null==e?void 0:e.spreedlyPaymentFormC2PSubmitEl,"data-spreedly-payment-c2p-submit-id"),i=document.getElementById(this.cvvTarget);if(r.parentNode.insertBefore(i,r.previousSibling.previousSibling),e.isGuest&&(this.getMerchantElementById(null==e?void 0:e.spreedlyPaymentFormSubmitEl,"data-spreedly-payment-submit-id").style.visibility="visible",r.style.visibility="hidden"),r&&this.cardsEl){var o="go-back-link"+this.uniqueId;if(!document.getElementById(o)){var a=document.createElement("a");a.href="#",a.id=o,a.textContent="Go back",a.onclick=function(){t.c2pSandboxLog("Go back"),n.style.visibility="hidden",t.cardsEl.style.visibility="visible",t.cardsEl.style.display="block",t.emit("display-cards-ready"),t.c2pCVVContainer()},r.parentNode.insertBefore(a,r.afterSibling)}}},this.loadOTPElements=function(e){var t,n=this,r=["overlay","none"].includes(null==e||null===(t=e.otp)||void 0===t?void 0:t.type)?e.otp.type:"overlay";this.otpEl=this.getMerchantElementById(null==e?void 0:e.otpEl,"data-otp-id"),this.otpChannelsEl=this.getMerchantElementById(null==e?void 0:e.otpChannelSelectionEl,"data-otp-channel-selection-target-id"),this.otpChannelsEl.locale=this.locale,this.otpEl.cardBrands=this.cardBrands,this.otpEl.style.visibility="visible",this.otpEl.type=r,this.otpEl.locale=this.locale,this.otpEl.addEventListener("continue",(0,a.default)(i.default.mark((function t(){var r,o;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.handleValidation();case 3:(r=t.sent).isValid?(n.otpEl.style.visibility="hidden",n.otpEl.type="none",n.displayCards(e,r.cards)):r.errorReason?(n.otpEl.errorReason=r.errorReason,"ACCT_INACCESSIBLE"===r.errorReason&&(o=[{attribute:"otp_code",key:"errors.acct_inaccessible",message:"The account exists but is not currently accessible (e.g. is locked)."}],n.emit("errors",o),n.otpEl.style.visibility="hidden",n.otpEl.type="none")):n.c2pSandboxLog("No cards present"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),n.c2pError("c2p_otp_handle_validation",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),this.otpEl.addEventListener("otpChanged",(function(e){return n.otpValue=e.detail,e})),this.otpEl.addEventListener("alternateRequested",(function(){var t;n.otpEl.style.visibility="hidden",n.otpEl.type="none",n.otpChannelsEl.style.visibility="visible",n.otpChannelsEl.type=["overlay","none"].includes(null==e||null===(t=e.otpChannels)||void 0===t?void 0:t.type)?e.otpChannels.type:"overlay",n.otpChannelsEl.cardBrands=n.cardBrands,n.otpChannelsEl.identityValidationChannels=n.otpChannels?n.otpChannels:n.otpDefaultChannel})),this.otpEl.addEventListener("close",(function(){return n.otpEl.style.visibility="hidden",n.otpEl.type="none",!1})),this.otpChannelsEl.addEventListener("continue",(function(){n.otpChannelsEl.style.visibility="hidden",n.otpChannelsEl.type="none","GUEST"===n.otpChannel.identityType?(e.isGuest=!0,n.makeVisibleNormalInit(e)):(n.otpEl.errorReason="",n.otpChannelRequested={requestedValidationChannelId:n.otpChannel.validationChannelId},n.handleOTP(e),n.otpEl.style.visibility="visible",n.otpEl.type=r)})),this.otpChannelsEl.addEventListener("selectChannel",(function(e){n.otpChannel=e.detail})),this.otpChannelsEl.addEventListener("close",(function(){return n.otpChannelsEl.style.visibility="hidden",n.otpChannelsEl.type="none",!1}))},this.otpInitiated=function(e,t){var n;this.otpEl||this.otpChannelsEl?(this.otpEl.style.visibility="visible",this.otpEl.type=["overlay","none"].includes(null==t||null===(n=t.otp)||void 0===n?void 0:n.type)?t.otp.type:"overlay"):this.loadOTPElements(t);this.otpEl.maskedIdentityValue=e.maskedValidationChannel,this.otpDefaultChannel=[{identityType:"EMAIL",validationChannelId:"EMAIL",identityProvider:e.network,maskedValidationChannel:e.maskedValidationChannel}],this.otpChannels=e.supportedValidationChannels},this.otpRejected=function(){return this.emit("errors",[{attribute:"otp_code",key:"errors.otp_permissions_denied",message:"Unexpected error happened when trying to initiate validation"}])},this.handleOTP=function(){var e=(0,a.default)(i.default.mark((function e(t){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.c2pSandboxLog("initiateValidation"),e.prev=1,e.next=4,this.click2payInstance.initiateValidation(this.otpChannelRequested);case 4:n=e.sent,this.otpInitiated(n,t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.otpRejected();case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.handleValidation=(0,a.default)(i.default.mark((function e(){var t,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={},e.prev=1,e.next=4,this.click2payInstance.validate({value:this.otpValue});case 4:t.cards=e.sent,t.isValid=(null==t||null===(n=t.cards)||void 0===n?void 0:n.length)>0,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),t.isValid=!1,t.errorReason=e.t0.reason;case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this,[[1,8]])}))),this.c2pCheckout=function(){var e=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setPermitableParams(t),this.setParam("c2p_dpa_id",this.c2p.dpaId),this.setParam("c2p_is_sandbox",this.c2p.isSandbox),null==t||!t.isCheckoutWithCard){e.next=9;break}return e.next=6,this.checkoutWithCard();case 6:t.isCheckoutWithCard=!1,e.next=11;break;case 9:this.setParam("c2p_available_card_brands",this.availableCardBrands),this.sendMessage("c2pNewCard");case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.c2pSDKValidationAndInitialParams=function(e){if(e)return e;var t=document.getElementsByTagName("script"),n=Array.prototype.slice.call(t),r=n.findIndex((function(e){return e.src.includes("src.mastercard.com/srci/integration/2/lib.js")}));if(r>-1){var i=t[r].src,o=new URL(i),a=i.includes("sandbox"),s=new URLSearchParams(o.search),c=s.get("srcDpaId"),l=s.get("locale");return c?l?{srcDpaId:c,c2pDpaLocale:l,c2pSandbox:a,c2pSrc:i,isValid:!0}:void console.error("Locale is missing in the src params"):void console.error("DPA ID is missing in the src params")}return{isValid:!1}},this.checkoutWithCardWindow=function(){var e=this.c2p.frame_id,t=this.c2p.frame_style;this.c2pFrameTarget=e||y("data-click-to-pay-frame-id");var n=this.c2pFrameTarget?this.c2pFrameTarget:"";return n&&(document.getElementById(this.c2pFrameTarget).style.visibility="visible",document.getElementById(this.c2pFrameTarget).style.display="block"),this.c2pFrameEl=window.open("",n,t),this.c2pFrameEl},this.checkoutWithCard=(0,a.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.c2pSandboxLog("checkoutWithCard"),e.prev=1,e.next=4,this.click2payInstance.checkoutWithCard({srcDigitalCardId:this.srcDigitalCardId,windowRef:this.checkoutWithCardWindow()});case 4:return t=e.sent,this.c2pSandboxLog(t),this.triggerGetC2PToken(t),e.abrupt("return",t);case 10:e.prev=10,e.t0=e.catch(1),this.c2pError("c2p_checkout_with_card",e.t0);case 13:case"end":return e.stop()}}),e,this,[[1,10]])}))),this.checkoutWithNewCard=function(){var e=(0,a.default)(i.default.mark((function e(t){var n,r,o,a,s,c,l;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.c2pSandboxLog("checkoutWithNewCard"),c={encryptedCard:t.JWE,windowRef:this.checkoutWithCardWindow(),cardBrand:t.cardType,consumer:{emailAddress:null===(n=this.customer)||void 0===n?void 0:n.email,mobileNumber:{phoneNumber:null===(r=this.customer)||void 0===r||null===(o=r.mobileNumber)||void 0===o?void 0:o.phoneNumber,countryCode:null===(a=this.customer)||void 0===a||null===(s=a.mobileNumber)||void 0===s?void 0:s.countryCode}}},e.prev=2,e.next=5,this.click2payInstance.checkoutWithNewCard(c);case 5:return l=e.sent,this.c2pSandboxLog(l),this.triggerGetC2PToken(l),e.abrupt("return",l);case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",this.c2pError("checkout_code","The card entered is not valid."));case 14:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),this.makeInvisibleC2PFrame=function(){document.getElementById(this.c2pFrameTarget).style.visibility="hidden",document.getElementById(this.c2pFrameTarget).style.display="none",this.c2pFrameEl.close()},this.triggerGetC2PToken=function(){var e=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.checkoutActionCode.toUpperCase(),e.next="CHANGE_CARD"===e.t0?3:"ADD_CARD"===e.t0?7:"SWITCH_CONSUMER"===e.t0?11:"CANCEL"===e.t0?15:"COMPLETE"===e.t0?19:24;break;case 3:return this.c2pSandboxLog("Consumer wishes to select an alternative card."),this.emit("checkout-different-pm"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 7:return this.c2pSandboxLog("Consumer wishes to add a new card."),this.emit("add-new-card"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 11:return this.c2pSandboxLog("Consumer wishes to change account profile / identity"),this.emit("c2p-session-deleted"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 15:return this.c2pSandboxLog("Consumer wishes to cancel the flow"),this.emit("checkout-cancelled"),this.makeInvisibleC2PFrame(),e.abrupt("break",27);case 19:return this.c2pSandboxLog("Checkout processing completed normally â€“ Success"),this.setParam("environment_key",this.environmentKey),this.setParam("c2p_checkout_response",t),this.sendMessage("getTokenBasedOnC2PToken"),e.abrupt("break",27);case 24:this.emit("checkout-error"),this.c2pSandboxLog("An error was detected and the checkout processing cannot continue","- resume normally Business as usual without click to pay"),console.error("An error was detected and the checkout processing cannot continue.");case 27:return e.abrupt("return",!1);case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.addIframeElements=function(){var e=u('<iframe sandbox="allow-scripts allow-same-origin" frameborder="0" width="100%" height="100%" scrolling="no"></iframe>');e.id=this.numberFrameId,e.name=this.numberFrameId,e.setAttribute("src",g("https://core.spreedly.com/v1/embedded/number-frame-1.107.html",b(this.source))),document.getElementById(this.numberTarget).appendChild(e);var t=u('<iframe sandbox="allow-scripts allow-same-origin" frameborder="0" width="100%" height="100%" scrolling="no"></iframe>');t.id=this.cvvFrameId,t.name=this.cvvFrameId,t.setAttribute("src",g("https://core.spreedly.com/v1/embedded/cvv-frame-1.107.html",b(this.source))),document.getElementById(this.cvvTarget).appendChild(t)},this.getMerchantElementById=function(e,t){var n=e||y(t);return document.getElementById(n)},this.stripeRadar=function(e,t,n){var r;if(!window.Stripe)return console.error("Cannot find Stripe on page."),t(null),null;var i={canCreateRadarSession:!0};if(null!=n&&n.stripeAccount&&(i.stripeAccount=n.stripeAccount),!(r=window.Stripe(e,i)))return console.error("Creating a Stripe session failed."),t(null),null;r.createRadarSession().then((function(e){var n;e.radarSession&&e.radarSession.id?n=e.radarSession.id:(e.error&&console.error("Spreedly: Creating a radar session failed. Reason: "+e.error.message),n=null),t(n)}))},this.createStripePaymentElement=function(e){if(!window.Stripe)return{error:"Cannot find Stripe on page."};if(!e.publishableKey)return{error:"Required input field 'publishableKey' was not supplied."};if(!e.clientSecret)return{error:"Required input field 'clientSecret' was not supplied."};if(!e.transactionToken)return{error:"Required input field 'transactionToken' was not supplied."};if(!e.paymentElement)return{error:"Required input field 'paymentElement' was not supplied."};var t=window.Stripe(e.publishableKey);if(!t)return{error:"Creating a Stripe session failed."};var n={clientSecret:e.clientSecret,appeareance:e.appeareance},r=e.spreedlyRoot||"https://core.spreedly.com",i={return_url:"".concat(r,"/transaction/").concat(e.transactionToken,"/redirect")},o=t.elements(n);return o.create("payment").mount(e.paymentElement),{confirmPayment:function(){return t.confirmPayment({elements:o,confirmParams:i})}}},this.createBraintreePaymentElements=function(e){var t,n,r,i,o=["callbackFunction","transactionToken","paymentElements","environmentKey"].filter((function(t){return Object.keys(e).indexOf(t)<0}));if(o.length>0)return{error:"Missing required parameter/s: ".concat(o)};var a=[];if(null!==(t=window.braintree)&&void 0!==t&&t.client||a.push("Client"),!e.paymentElements.paypal||null!==(n=window.braintree)&&void 0!==n&&n.paypalCheckout||a.push("Paypal Checkout"),!e.paymentElements.venmo||null!==(r=window.braintree)&&void 0!==r&&r.venmo||a.push("Venmo"),!e.paymentElements.venmo||null!==(i=window.braintree)&&void 0!==i&&i.dataCollector||a.push("Data Collector"),a.length>0)return{error:"The following Braintree scripts are not present on page: ".concat(a)};if("function"!=typeof e.callbackFunction)return{error:"Required parameter 'callbackFunction' is not a function."};var s=function(t){var n;if(t.transaction){var r={amount:t.transaction.amount/100,currencyCode:t.transaction.currency_code,clientToken:t.transaction.client_token,paymentMethodUsed:t.transaction.payment_method_type,paypalFlow:t.transaction.paypal_flow_type,transactionType:t.transaction.transaction_type,venmoFlow:t.transaction.venmo_flow_type,venmoProfileId:t.transaction.venmo_profile_id,billingAgreementDescription:t.transaction.billing_agreement_description,lineItems:t.transaction.line_items,shippingAddress:t.transaction.shipping_address,locale:t.transaction.locale};if(!["vault","checkout_with_vault"].includes(r.paypalFlow)||!e.paymentElements.paypal||null!==(n=window.braintree)&&void 0!==n&&n.dataCollector)if(Object.keys(e.paymentElements).includes(r.paymentMethodUsed.toLowerCase()))l(t.transaction.created_at)?v.initializeBraintreeButtons(e,r):console.error("The client token is no longer valid.");else console.error("Cannot find payment element corresponding to payment method used during transaction.");else console.error("The Data Collector Braintree script is not present on page")}else console.error("An error occured while obtaining required information from transactionToken.")},c=function(){console.error("An error occured while obtaining required information from transactionToken.")},l=function(e){var t=new Date(e),n=new Date;return!(Math.abs(t.getTime()-n.getTime())>=864e5)};"testToken"==e.transactionToken?window.withStatus(e.transactionToken,e.environmentKey,s,c):m.withStatus(e.transactionToken,e.environmentKey,s,c)},this.checkUniqueId=function(e){return e===this.uniqueId},this.on=function(e,t){this.emitter.on(e,t)},this.emit=function(e,t,n,r,i){this.emitter.emit(e,t,n,r,i)},this.c2pError=function(e,t){var n={attribute:e,key:"errors.".concat(e),message:t};return this.emit("errors",[n])},this.isLoaded=function(){return!(!this.numberFrameId&&!this.cvvFrameId)&&!(!document.getElementById(this.numberFrameId)&&!document.getElementById(this.cvvFrameId))},this.reload=function(){this.unload();var e={numberEl:this.numberTarget,cvvEl:this.cvvTarget};this.init(this.environmentKey,e)},this.removeHandlers=function(){p(this.emitter)},this.resetFields=function(){this.sendMessage("reset")},this.sendMessage=function(e){document.getElementById(this.numberFrameId).contentWindow.postMessage(e,"https://core.spreedly.com")},this.setValue=function(e,t){"cvv"===e?this.sendMessage("setCvv: "+t):"number"===e&&this.sendMessage("setNumber: "+t)},this.setLabel=function(e,t){"cvv"===e?this.sendMessage("setCvvLabel: "+t):"number"===e&&this.sendMessage("setNumberLabel: "+t)},this.setTitle=function(e,t){"cvv"===e?this.sendMessage("setCvvTitle: "+t):"number"===e&&this.sendMessage("setNumberTitle: "+t)},this.setInputMode=function(e,t){"cvv"===e?this.sendMessage("setCvvInputMode: "+t):"number"===e&&this.sendMessage("setNumberInputMode: "+t)},this.setFieldType=function(e,t){t||(t=e,e="number"),"cvv"===e?this.sendMessage("setCvvType: "+t):"number"===e&&this.sendMessage("setNumberType: "+t)},this.setNumberFormat=function(e){this.sendMessage("numberFormat: "+e)},this.toggleAutoComplete=function(){this.sendMessage("autoComplete")},this.toggleMask=function(){this.sendMessage("toggleMask")},this.setPlaceholder=function(e,t){this.sendMessage("placeholder: "+e+":"+t)},this.setParam=function(e,t){"object"===(0,o.default)(t)&&null!==t&&(t=JSON.stringify(t)),this.sendMessage("param("+e+"): "+t)},this.setStyle=function(e,t){this.sendMessage("style("+e+"): "+t)},this.setRecache=function(e,t){this.sendMessage("setRecache: "+e),this.setParam("environment_key",this.environmentKey),t&&t.last_four_digits&&this.setParam("last_four_digits",t.last_four_digits),t&&t.card_type&&this.setParam("card_type",t.card_type)},this.recache=function(){this.sendMessage("recache")},this.setPermitableParams=function(e){if(this.setParam("environment_key",this.environmentKey),e){var t,n=Object.keys(e),r=s(x);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.includes(i)&&("string"!=typeof e[i]&&"number"!=typeof e[i]||!e[i]?console.warn("Tokenization parameter ".concat(i," should be type string, was type ").concat((0,o.default)(e[i]))):this.setParam(i,e[i]))}}catch(e){r.e(e)}finally{r.f()}var a,c=s(E);try{for(c.s();!(a=c.n()).done;){var l=a.value;n.includes(l)&&("boolean"==typeof e[l]||"true"===e[l].toLowerCase()||"false"===e[l].toLowerCase()?this.setParam(l,e[l]):console.warn("Tokenization parameter ".concat(l," should be type boolean or string 'true' or 'false'")))}}catch(e){c.e(e)}finally{c.f()}var u,d=s(C);try{for(d.s();!(u=d.n()).done;){var p=u.value;n.includes(p)&&("object"===(0,o.default)(e[p])?this.setParam(p,e[p]):console.warn("Tokenization parameter ".concat(p," should be type object, was type ").concat((0,o.default)(e[p]))))}}catch(e){d.e(e)}finally{d.f()}}},this.tokenizeCreditCard=function(e){return this.setPermitableParams(e),this.sendMessage("getToken"),!1},this.transferFocus=function(e){this.sendMessage("focus: "+e)},this.unload=function(){var e=document.getElementById(this.numberFrameId);e&&e.parentNode.removeChild(e);var t=document.getElementById(this.cvvFrameId);t&&t.parentNode.removeChild(t)},this.validate=function(){this.sendMessage("validate")},this.buildMessageHandler=function(){var e=this;return function(t){if(("string"==typeof t.data||t.data instanceof String)&&"https://core.spreedly.com"===t.origin&&e.checkUniqueId(t.data.substring(0,4))&&e.isLoaded()){var n,r=t.data.substring(4);if("frameLoaded:"===r);else if("iframesReady"===r)e.source&&e.sendMessage("source: "+e.source),e.emit("ready");else if("recacheReady"===r)e.emit("recacheReady");else if(n=r.match(/paymentMethod\((.*)\): (.*)/i))e.emit("paymentMethod",n[1],JSON.parse(n[2]));else if(n=r.match(/c2pCard: (.*)/i)){var i=JSON.parse(n[1]);e.checkoutWithNewCard(i)}else if(n=r.match(/recacheResult\((.*)\): (.*)/i))e.emit("recache",n[1],JSON.parse(n[2]));else if(n=r.match(/errors: (.*)/i))e.emit("errors",JSON.parse(n[1]));else if(n=r.match(/validation: (.*)/i))e.emit("validation",JSON.parse(n[1]));else if(n=r.match(/input: (.*)/i)){var o=JSON.parse(n[1]),a=o.activeElement;e.emit("fieldEvent",a,"input",a,o)}else(n=r.match(/notifyEvent\( (.*)\): (.*):(.*)/i))?e.emit("fieldEvent",n[1],n[2],n[3],{}):(n=r.match(/consoleError: (.*)/i))?e.emit("consoleError",JSON.parse(n[1])):"numberSet"===r?e.emit("numberSet"):"cvvSet"===r?e.emit("cvvSet"):(n=r.match(/sourceSet: (.*)/i))&&e.emit("sourceSet",n[1])}}},this.uniqueId=(Math.floor(8999*Math.random())+1e3).toString(),this.messageHandler=this.buildMessageHandler(),l.addListener(window,"message",this.messageHandler),this.emitter=new d}var k=new w;e.exports=k,window.Spreedly=k,window.SpreedlyPaymentFrame=w;var x=["first_name","last_name","full_name","email","month","year","address1","address2","city","state","zip","country","phone_number","company","shipping_address1","shipping_address2","shipping_city","shipping_state","shipping_zip","shipping_country","shipping_phone_number"],E=["eligible_for_card_updater"],C=["metadata"]},function(e,t){e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("String expected");t||(t=document);var n=/<([\w:]+)/.exec(e);if(!n)return t.createTextNode(e);e=e.replace(/^\s+|\s+$/g,"");var r=n[1];if("body"==r){return(o=t.createElement("html")).innerHTML=e,o.removeChild(o.lastChild)}var o,a=Object.prototype.hasOwnProperty.call(i,r)?i[r]:i._default,s=a[0],c=a[1],l=a[2];(o=t.createElement("div")).innerHTML=c+e+l;for(;s--;)o=o.lastChild;if(o.firstChild==o.lastChild)return o.removeChild(o.firstChild);var u=t.createDocumentFragment();for(;o.firstChild;)u.appendChild(o.removeChild(o.firstChild));return u};var n,r=!1;"undefined"!=typeof document&&((n=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',r=!n.getElementsByTagName("link").length,n=void 0);var i={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:r?[1,"X<div>","</div>"]:[0,"",""]};i.td=i.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],i.option=i.optgroup=[1,'<select multiple="multiple">',"</select>"],i.thead=i.tbody=i.colgroup=i.caption=i.tfoot=[1,"<table>","</table>"],i.polyline=i.ellipse=i.polygon=i.circle=i.text=i.line=i.path=i.rect=i.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},function(e,t,n){"use strict";var r,i,o,a,s,c,l,u=n(35),d=n(52),p=Function.prototype.apply,h=Function.prototype.call,f=Object.create,m=Object.defineProperty,v=Object.defineProperties,y=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var n,i;return d(t),i=this,r.call(this,e,n=function(){o.call(i,e,n),p.call(t,this,arguments)}),n.__eeOnceListener__=t,this},s={on:r=function(e,t){var n;return d(t),y.call(this,"__ee__")?n=this.__ee__:(n=g.value=f(null),m(this,"__ee__",g),g.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i,off:o=function(e,t){var n,r,i,o;if(d(t),!y.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"==typeof(r=n[e]))for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:a=function(e){var t,n,r,i,o;if(y.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)p.call(r,this,o)}else switch(arguments.length){case 1:h.call(i,this);break;case 2:h.call(i,this,arguments[1]);break;case 3:h.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];p.call(i,this,o)}}},c={on:u(r),once:u(i),off:u(o),emit:u(a)},l=v({},c),e.exports=t=function(e){return null==e?f(l):v(Object(e),c)},t.methods=s},function(e,t,n){"use strict";var r=n(15),i=n(36),o=n(40),a=n(48),s=n(49);(e.exports=function(e,t){var n,i,c,l,u;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],r(e)?(n=s.call(e,"c"),i=s.call(e,"e"),c=s.call(e,"w")):(n=c=!0,i=!1),u={value:t,configurable:n,enumerable:i,writable:c},l?o(a(l),u):u}).gs=function(e,t,n){var c,l,u,d;return"string"!=typeof e?(u=n,n=t,t=e,e=null):u=arguments[3],r(t)?i(t)?r(n)?i(n)||(u=n,n=void 0):n=void 0:(u=t,t=n=void 0):t=void 0,r(e)?(c=s.call(e,"c"),l=s.call(e,"e")):(c=!0,l=!1),d={get:t,set:n,configurable:c,enumerable:l},u?o(a(u),d):d}},function(e,t,n){"use strict";var r=n(37),i=/^\s*class[\s{/}]/,o=Function.prototype.toString;e.exports=function(e){return!!r(e)&&!i.test(o.call(e))}},function(e,t,n){"use strict";var r=n(38);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!r(e)}},function(e,t,n){"use strict";var r=n(39);e.exports=function(e){if(!r(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(15),i={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!r(e)&&hasOwnProperty.call(i,typeof e)}},function(e,t,n){"use strict";e.exports=n(41)()?Object.assign:n(42)},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var r=n(43),i=n(47),o=Math.max;e.exports=function(e,t){var n,a,s,c=o(arguments.length,2);for(e=Object(i(e)),s=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},a=1;a<c;++a)r(t=arguments[a]).forEach(s);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=n(44)()?Object.keys:n(45)},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";var r=n(10),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(10);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";var r=n(10),i=Array.prototype.forEach,o=Object.create,a=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=o(null);return i.call(arguments,(function(e){r(e)&&a(Object(e),t)})),t}},function(e,t,n){"use strict";e.exports=n(50)()?String.prototype.contains:n(51)},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&(!0===r.contains("dwa")&&!1===r.contains("foo"))}},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";var r=n(54),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t,n=arguments[1];if(r(e),void 0===n)i.call(e,"__ee__")&&delete e.__ee__;else{if(!(t=i.call(e,"__ee__")&&e.__ee__))return;t[n]&&delete t[n]}}},function(e,t,n){"use strict";var r=n(55);e.exports=function(e){if(!r(e))throw new TypeError(e+" is not an Object");return e}},function(e,t,n){"use strict";var r=n(56),i={function:!0,object:!0};e.exports=function(e){return r(e)&&i[typeof e]||!1}},function(e,t,n){"use strict";var r=n(57)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(16),i=n(17),o=n(11);e.exports={Request:r,Retryable:i,tokenGenerator:o}},function(e,t,n){"use strict";var r=n(60),i=n(61);e.exports={Lifecycle:i,serialize:r.serialize}},function(e,t,n){"use strict";function r(e){return function(t){var n=t||window;return n.screen&&n.screen[e]||null}}function i(e){return function(t){var n=t||window;return n.navigator&&n.navigator[e]||null}}function o(){return(new Date).getTimezoneOffset()}function a(e){var t=e||window;return t.navigator&&t.navigator.javaEnabled?t.navigator.javaEnabled():null}var s=r("width"),c=r("height"),l=r("colorDepth"),u=i("userAgent"),d=i("language");e.exports={width:s,height:c,depth:l,timezone:o,userAgent:u,java:a,language:d,serialize:function(e,t,n){var r=n||window;return btoa(JSON.stringify(function(e,t,n){var r=n||window;return{width:s(r),height:c(r),depth:l(r),timezone:o(),user_agent:u(r),java:a(r),language:d(r),browser_size:e,accept_header:t||"text/html,application/xhtml+xml,application/xml"}}(e,t,r)))}}},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(3),s=n(19),c=n(62),l=n(64),u=n(66),d=n(67),p=n(69),h=n(70),f=n(71),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.default)(this,e),this.hiddenIframeLocation=s(t.hiddenIframeLocation,"hiddenIframeLocation option"),this.transactionToken=s(t.transactionToken,"transactionToken option"),this.challengeIframeLocation=s(t.challengeIframeLocation,"challengeIframeLocation option"),this.challengeIframeClasses=t.challengeIframeClasses,this.environmentKey=s(t.environmentKey,"environmentKey option",!0),this.Redirect=t.Redirect||d,this.Challenge=t.Challenge||f,this.DeviceFingerprint=t.DeviceFingerprint||h,this.start=this.start.bind(this),this.poll=this.poll.bind(this),this.stopPolling=this.stopPolling.bind(this),this.finalize=this.finalize.bind(this),this.event=this.event.bind(this),this.error=this.error.bind(this),this.installPoller=this.installPoller.bind(this),this.poller=t.poller,this.statusManager=t.statusManager||new l,this.eventPublisher=new c(this.finalize,this.transactionToken,this.statusManager,t.notifier||window.Spreedly),this.StatusPolling=t.StatusPolling||a,this.deviceFingerprintTimeoutTask=t.deviceFingerprintTimeoutTask||new u(10,"device-fingerprint",this.eventPublisher)}return(0,o.default)(e,[{key:"installExtensions",value:function(e){"braintree"===e.gateway_type&&(this.DeviceFingerprint=p)}},{key:"start",value:function(){var e=this;this.StatusPolling.withContext(this.transactionToken,this.environmentKey,(function(t){e.installExtensions(t),e.handleUpdate("start",t)}))}},{key:"poll",value:function(e){return this.handleUpdate("polling",e)}},{key:"stopPolling",value:function(){this.poller&&this.poller.stop()}},{key:"installPoller",value:function(e){if(!e)return!1;this.stopPolling(),this.poller=e,this.poller.run()}},{key:"finalize",value:function(e){if(!this.statusManager.recordOnChange("finalize",{state:"finalize"}))return"noop";this.Challenge.run(e,this.transactionToken,this.environmentKey,this.challengeIframeLocation,this.challengeIframeClasses,this.poll,this.finalize,this.installPoller,this.eventPublisher)}},{key:"handleUpdate",value:function(e,t){if(!this.statusManager.recordOnChange(e,t))return"noop";switch("".concat(t.state," & ").concat(t.required_action)){case"pending & redirect":case"pending & fallback":return this.Redirect.run(this,t,this.hiddenIframeLocation),"redirect";case"pending & challenge":return"start"!==e&&"polling"!==e||this.finalize(t),"challenge";case"pending & device_fingerprint":return this.DeviceFingerprint.run(t,this.transactionToken,this.environmentKey,this.hiddenIframeLocation,this.finalize,this.poll,this.installPoller,this.eventPublisher,this.deviceFingerprintTimeoutTask),"device_fingerprint"}return"succeeded"===t.state?(this.stopPolling(),this.event("handleEvent","succeeded",t),"succeeded"):"failed"===t.state||"gateway_processing_failed"===t.state||"gateway_setup_failed"===t.state?(this.stopPolling(),this.error("handleUpdate","Failed to process transaction",t),"failed"):void 0}},{key:"error",value:function(e,t,n){var r={state:n.state,message:n.message,error_code:n.error_code};this.stopPolling(),this.eventPublisher.error(e,t,r)}},{key:"event",value:function(e,t,n){return this.eventPublisher.event(e,t,n)}}]),e}();e.exports=m},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(63),s=function(){function e(t,n,r,o){(0,i.default)(this,e),this.finalize=t,this.transactionToken=n,this.statusManager=r,this.event=this.event.bind(this),this.error=this.error.bind(this),this.notifier=o||window.Spreedly}return(0,o.default)(e,[{key:"event",value:function(e,t,n,r){return!!this.statusManager.recordOnChange(e,t,a)&&this.notifier.emit("3ds:status",{action:t,context:n,token:this.transactionToken,finalize:this.finalize,response:r})}},{key:"error",value:function(e,t,n){return this.event(e,"error",t,n)}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(t,n,r){(0,i.default)(this,e),this.initiator=t,this.index=n,this.action=r}return(0,o.default)(e,[{key:"getInitiator",value:function(){return this.initiator}},{key:"getIndex",value:function(){return this.index}},{key:"getType",value:function(){return"EventStatus"}},{key:"getAction",value:function(){return this.action}},{key:"diff",value:function(e){return e.getType()!==this.getType()||e.getAction()!==this.action}},{key:"toString",value:function(){return["Type:            ".concat(this.getType()),"Initiator:       ".concat(this.initiator),"Index:           ".concat(this.index),"Action:          ".concat(this.action)].join("\n")}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=n(65),s=function(){function e(){(0,i.default)(this,e),this.statuses=[new a]}return(0,o.default)(e,[{key:"getCurrentStatus",value:function(){return this.statuses[this.statuses.length-1]}},{key:"recordOnChange",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a,r=new n(e,this.statuses.length,t),i=0;i<this.statuses.length;i++){var o=this.statuses[i];if(!o.diff(r))return!1}return this.statuses.push(r),!0}}]),e}();e.exports=s},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.default)(this,e),this.initiator=t||"unknown",this.index=n||0,this.state=r.state||"unknown",this.requiredAction=r.required_action||"unknown"}return(0,o.default)(e,[{key:"getInitiator",value:function(){return this.initiator}},{key:"getIndex",value:function(){return this.index}},{key:"getRequiredAction",value:function(){return this.requiredAction}},{key:"getState",value:function(){return this.state}},{key:"getType",value:function(){return"Status"}},{key:"diff",value:function(e){return e.getType()!==this.getType()||e.getState()!==this.state||e.getRequiredAction()!==this.requiredAction}},{key:"toString",value:function(){return["Type:            ".concat(this.getType()),"Initiator:       ".concat(this.initiator),"Index:           ".concat(this.index),"State:           ".concat(this.state),"Required Action: ".concat(this.requiredAction)].join("\n")}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(t,n,r){(0,i.default)(this,e),this.timeInSeconds=t,this.context=n,this.eventPublisher=r}return(0,o.default)(e,[{key:"start",value:function(e){this.eventPublisher.event("CancelableTask","".concat(this.context,"#start"),this),this.task=setTimeout(e,1e3*this.timeInSeconds)}},{key:"stop",value:function(){this.eventPublisher.event("CancelableTask","".concat(this.context,"#stop"),this),this.task&&clearTimeout(this.task)}}]),e}();e.exports=a},function(e,t,n){"use strict";var r=n(68);e.exports={run:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;i(t,n)?e.event("Redirect.run","fallback",t):e.error("Redirect.run","fallback",t)}}},function(e,t,n){"use strict";var r=n(12),i=n(13);e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;if(!r(t))throw"A DOM id is required for injecting the 3DS 1 fallback";var o=i(e,"checkout_form");if(r(o)&&!/action\=\"\"/.test(o)){n.document.getElementById(t).innerHTML=o;var a=n.document.getElementById(t).getElementsByTagName("form");if(a.length>0)return a[0].submit(),!0}else if(r(e.checkout_url))return n.location=e.checkout_url,!0;return!1}},function(e,t,n){"use strict";var r=n(0),i=r(n(4)),o=r(n(1)),a=r(n(2));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=n(18),u=n(3),d=function(){function e(){(0,o.default)(this,e)}return(0,a.default)(e,null,[{key:"run",value:function(e,t,n,r,i,o,a,s,d,p,h,f,m){var v=f||braintree,y=m||l,g=new(h||u)(t,o,(function(e){s.error("Braintree 3DS timeout",e),o(e)}),n,200);s.event("Braintree Integration","device-fingerprint",e);var b=y.decode(e&&e.three_ds_context),w=c(c({},b.threeDSecureParameters),{},{onLookupComplete:function(e,t){t()}});v.client.create({authorization:b.clientToken},(function(e,t){if(e)return g.stop(),void s.error("Braintree client error",{originalError:e});v.threeDSecure.create({version:2,client:t},(function(e,t){if(e)return g.stop(),void s.error("Braintree 3DS Client error",{originalError:e});t.verifyCard(w,(function(e,t){if(e)return g.stop(),void s.error("Braintree 3DS Authentication error",{originalError:e});s.event("Braintree 3DS Integration","trigger-completion",{payment_method_nonce:t.nonce})}))}))})),a(g)}}]),e}();e.exports=d},function(e,t,n){"use strict";var r=n(0)(n(4));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var a=n(13),s=n(3),c=n(20).makeFrameManager;e.exports={run:function(e,t,n,r,i,l,u,d,p,h,f){var m=f||s,v=(h||c)({frameId:"challenge-flow",destination:r,url:e.device_fingerprint_form_embed_url,contents:a(e,"device_fingerprint_form")}),y=v.success,g=v.frameManager;if(y&&g){var b=new m(t,l,(function(t){var n=o(o({},e),t);d.event("DeviceFingerprint polling","trigger-completion",n),l(n)}),n,20);"worldpay"===e.gateway_type?(p.start((function(){return d.error("deviceFingerprintTimeoutTask#start",e)})),window.addEventListener("message",(function(e){!function(e,t,n){var r=null;try{r=JSON.parse(e.data)}catch(t){r=e.data}r&&"profile.completed"===r.MessageType&&(n.stop(),t.event("sendPostMessageWhenTrusted","trigger-completion",r))}(e,d,p)}),!1)):d.event("DeviceFingerprint.run","device-fingerprint",e),u(b)}else d.error("DeviceFingerprint.run",o({step:"device-fingerprint"},e)),u(null)}}},function(e,t,n){"use strict";var r=n(0)(n(4));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var a=n(72),s=n(3);e.exports={run:function(e,t,n,r,i,c,l,u,d,p,h){var f=p||s,m=h||a,v=null;"pending"!==e.state||"challenge"!==e.required_action?d.error("Challenge.run",{state:e,errors:["Failed to finalize. The transaction is not in the correct state. State should be 'pending' and required action should be 'challenge'"]}):m(e,r,i)?(d.event("Challenge.run","challenge",e),v=new f(t,(function(t){return c(o(o({},e),t))}),(function(){return d.event("Challenge polling","finalization-timeout")}),n,1200)):d.error("Challenge.run",{state:e,errors:["Failed to inject the challenge iframe, is the challengeIframeLocation valid?"]});u(v)}}},function(e,t,n){"use strict";var r=n(0)(n(4));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var a=n(12),s=n(13),c=n(20).makeFrameManager,l=n(11);e.exports=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l;if(!t)throw"A DOM id is required for injecting the challenge form.";var u=s(e,"challenge_form"),d=e.challenge_form_embed_url,p={frameId:"challenge-iframe-".concat(i()),frameManagerClass:r,destination:t,injectOptions:{show:!0,classes:n}},h=null;if(a(d))h=c(o({url:d},p)).frameManager;else if(a(u))h=c(o({contents:u},p)).frameManager;else{if(!a(e.challenge_url))throw"challenge_form and challenge_url are missing. Ensure that one of them is included.";h=c(o({url:e.challenge_url},p)).frameManager}return h}},function(e,t,n){"use strict";var r=n(0),i=r(n(1)),o=r(n(2)),a=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"initializeBraintreeButtons",value:function(t,n){braintree.client.create({authorization:n.clientToken},(function(r,i){r?console.error("Error creating client: ".concat(r)):(t.paymentElements.paypal&&e.paypalButton(t,i,n),t.paymentElements.venmo&&e.venmoButton(t,i,n))}))}},{key:"shippingAddressParams",value:function(e){if(e.shippingAddress&&e.shippingAddress.shipping_address1&&e.shippingAddress.shipping_city&&e.shippingAddress.shipping_state&&e.shippingAddress.shipping_zip&&e.shippingAddress.shipping_country)return{line1:e.shippingAddress.shipping_address1,city:e.shippingAddress.shipping_city,state:e.shippingAddress.shipping_state,postalCode:e.shippingAddress.shipping_zip,countryCode:e.shippingAddress.shipping_country,line2:e.shippingAddress.shipping_address2||"",phone:e.shippingAddress.shipping_phone_number||"",recipientName:e.shippingAddress.shipping_full_name||""}}},{key:"lineItemsParams",value:function(e){var t=[];return e.lineItems&&e.lineItems.forEach((function(e){if(e.quantity&&e.unit_amount&&e.name&&e.kind){var n={quantity:e.quantity,unitAmount:e.unit_amount/100,name:e.name,kind:e.kind,description:e.description||"",productCode:e.product_code||"",url:e.url||""};e.unit_tax_amount&&(n.unitTaxAmount=e.unit_tax_amount/100),t.push(n)}})),t}},{key:"checkoutFlowParams",value:function(t){var n={flow:"checkout",amount:t.amount,currency:t.currencyCode,intent:"OffsiteSynchronousAuthorization"==t.transactionType?"authorize":"capture"};"checkout_with_vault"==t.paypalFlow&&(n.requestBillingAgreement=!0,t.billingAgreementDescription&&(n.billingAgreementDetails={description:t.billingAgreementDescription}));var r=e.shippingAddressParams(t);r&&(n.shippingAddressOverride=r,n.enableShippingAddress=!0,n.shippingAddressEditable=!1);var i=e.lineItemsParams(t);return i.length&&(n.lineItems=i),n}},{key:"vaultFlowParams",value:function(t){var n={flow:"vault"};t.billingAgreementDescription&&(n.billingAgreementDescription=t.billingAgreementDescription);var r=e.shippingAddressParams(t);return r&&(n.shippingAddressOverride=r,n.enableShippingAddress=!0,n.shippingAddressEditable=!1),n}},{key:"venmoParams",value:function(e,t){var n={client:t,allowDesktop:!0};return e.venmoFlow&&(n.paymentMethodUsage=e.venmoFlow),e.venmoProfileId&&(n.profileId=e.venmoProfileId),n}},{key:"paypalButton",value:function(t,n,r){var i="";function o(n){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s={payment_method_type:"paypal"};function c(e){var t={state:"Successful",nonce:e.nonce,payment_method:s};return"vault"!=r.paypalFlow&&"checkout_with_vault"!=r.paypalFlow||(t.device_data=i),t}if(o={fundingSource:null!=a?a:paypal.FUNDING.PAYPAL,onApprove:function(e){return n.tokenizePayment(e,(function(e,n){t.callbackFunction(c(n))}))},onCancel:function(e){t.callbackFunction({state:"Cancelled",message:"PayPal payment cancelled, ".concat(JSON.stringify(e,null,2)),payment_method:s})},onError:function(e){t.callbackFunction({state:"Failed",message:e,payment_method:s})}},"vault"==r.paypalFlow?o.createBillingAgreement=function(){return n.createPayment(e.vaultFlowParams(r))}:o.createOrder=function(){return n.createPayment(e.checkoutFlowParams(r))},a){var l,u={},d=null==t||null===(l=t.style)||void 0===l?void 0:l.paypal;u=d?e.stylingButtons("paypal",d):{color:"gold"},o.style=u}return o}"vault"!=r.paypalFlow&&"checkout_with_vault"!=r.paypalFlow||braintree.dataCollector.create({client:n},(function(e,t){e?console.error("Error occured in the creation of data collector: ".concat(e)):i=t.deviceData})),braintree.paypalCheckout.create({client:n},(function(e,n){e?console.error("Error creating PayPal Checkout component: ".concat(e)):n.loadPayPalSDK(function(){var e={};e="vault"==r.paypalFlow?{vault:!0}:{currency:r.currencyCode,intent:"OffsiteSynchronousAuthorization"==r.transactionType?"authorize":"capture"};r.locale&&(e.locale=r.locale);return e}(),(function(){"checkout"==r.paypalFlow?[paypal.FUNDING.PAYPAL,paypal.FUNDING.PAYLATER].forEach((function(e){var r=paypal.Buttons(o(n,e));r.isEligible()&&r.render("#".concat(t.paymentElements.paypal))})):paypal.Buttons(o(n)).render("#".concat(t.paymentElements.paypal))}))}))}},{key:"stylingButtons",value:function(e,t){if("paypal"==e){var n={min:25,max:55},r={};return["vertical","horizontal"].includes(null==t?void 0:t.layout)&&(r.layout=t.layout),["rect","pill"].includes(null==t?void 0:t.shape)&&(r.shape=t.shape),(null==t?void 0:t.height)>=n.min&&(null==t?void 0:t.height)<=n.max&&(r.height=t.height),["gold","blue","silver","white","black"].includes(null==t?void 0:t.color)&&(r.color=t.color),r}}},{key:"venmoButton",value:function(t,n,r){var i;function o(e,n){t.callbackFunction({state:"Cancelled",message:"VENMO_CANCELED"===e.code?"App is not available or user aborted payment flow":"User canceled payment flow",payment_method:n})}function a(e,n){t.callbackFunction({state:"Failed",message:"An error occurred: ".concat(e.message),payment_method:n})}function s(e,n){t.callbackFunction({state:"Successful",nonce:e.nonce,payment_method:n,device_data:i,username:e.details.username})}braintree.dataCollector.create({client:n,paypal:!0},(function(e,t){e?console.error("Error occured in the creation of data collector: ".concat(e)):i=t.deviceData})),braintree.venmo.create(e.venmoParams(r,n),(function(e,n){if(e)console.error("Error creating Venmo: ".concat(e));else if(n.isBrowserSupported()){var r={payment_method_type:"venmo"};!function(e,n){var r=document.getElementById(t.paymentElements.venmo);r.style.display="block",r.addEventListener("click",(function(){r.disabled=!0,e.tokenize((function(e,t){r.removeAttribute("disabled"),e?"VENMO_CANCELED"===e.code||"VENMO_APP_CANCELED"===e.code||"VENMO_DESKTOP_CANCELED"===e.code?o(e,n):a(e,n):s(t,n)}))}))}(n,r),n.hasTokenizationResult()&&n.tokenize((function(e,t){e?"VENMO_CANCELED"===e.code||"VENMO_APP_CANCELED"===e.code?o(e,r):a(e,r):s(t,r)}))}else console.error("Browser does not support Venmo")}))}}]),e}();e.exports=a}]);